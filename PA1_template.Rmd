---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---


## Loading and preprocessing the data

```{r echo=TRUE}
#Download and unzip the data file
address <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip"
address <- sub("^https", "http", address) #https does not work
zipname <- "activity.zip"
download.file(address,zipname)
unzip(zipname)
csvname <- "activity.csv"
activity <- read.csv(csvname)

#housekeeping - remove the zip as it is no longer needed
file.remove(zipname, csvname)
#housekeeping
rm(address, zipname, csvname)
```

## What is mean total number of steps taken per day?

```{r}
stepsperdate <- (aggregate(steps ~ date, data=activity, sum))
hist(stepsperdate$steps, breaks=10)
meanstepsperdate <- mean(stepsperdate$steps)
meanstepsperdate

medianstepsperdate <- median(stepsperdate$steps)
medianstepsperdate
```

The mean total numbers of steps taken per day is `r sprintf("%.2f", meanstepsperdate)`.
The median total numbers of steps taken per day is `r medianstepsperdate`.


## What is the average daily activity pattern?

```{r}
meanstepsperinterval <- (aggregate(steps ~ interval, data=activity, mean))
plot(meanstepsperinterval, type="l")

interval_with_max_steps <- meanstepsperinterval$interval[which(meanstepsperinterval$steps == max(meanstepsperinterval$steps))]
interval_with_max_steps 
```

The interval with the most steps is `r interval_with_max_steps`.

## Imputing missing values

I replace the missing values with the mean for that period.

```{r}
number_of_missing_values <- sum(is.na(activity$steps))
number_of_missing_values

intervals_missing_steps <- activity$interval[is.na(activity$steps)]
means_for_missing_steps <-
sapply(intervals_missing_steps,
       function(x) meanstepsperinterval$steps[
         meanstepsperinterval$interval==x
       ]
       )

new_activity <- activity
new_activity$steps[is.na(new_activity$steps)] <- means_for_missing_steps

head(activity)
head(new_activity)
```

The number of missing values is `r number_of_missing_values`.

```{r}

new_stepsperdate <- (aggregate(steps ~ date, data=new_activity, sum))
hist(new_stepsperdate$steps, breaks=10)
newmean_stepsperdate <- mean(new_stepsperdate$steps)
newmean_stepsperdate

newmedian_stepsperdate <- median(new_stepsperdate$steps)
newmedian_stepsperdate
```
The mean total numbers of steps taken per day for the data set with imputed missing values
is `r sprintf("%.2f", newmean_stepsperdate)`
versus `r sprintf("%.2f", meanstepsperdate)` in the data set with missing values.
The median total numbers of steps taken per day for the data set with imputed missing values
is `r sprintf("%.2f", newmedian_stepsperdate)`
versus `r medianstepsperdate` in the data set with missing values.



## Are there differences in activity patterns between weekdays and weekends?
```{r}
library(lubridate)

activity$weekdays <- weekdays(ymd(activity$date))

activity$weekend <- "weekday"
activity$weekend[activity$weekdays %in%
                 c("Saturday","Sunday") ] <- "weekend"

meanstepsweekend <- (aggregate(steps ~ interval + weekend,
                               data=activity, mean))

library(lattice)
xyplot(steps ~ interval | weekend,
       data=meanstepsweekend,
       layout=c(1,2,1),
       panel=panel.lines)
```

The activity pattern during weekdays shows a clear spike in the morning. The activity pattern during the weekend is more evenly distributed.
